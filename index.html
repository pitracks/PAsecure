<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Allow unsafe-eval for TensorFlow.js -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:;">
    <title>PASecure - ID Verification System</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <div class="city-logo-text">
                    <div class="logo-line-1">LUNGSOD NG</div>
                    <div class="logo-line-2">PASIG</div>
                    <div class="logo-line-3">UMAAGOS ANG PAG-ASA</div>
                </div>
                <div class="app-title">
                    <h1>PASecure</h1>
                    <p>ID Verification System</p>
                </div>
            </div>
            <nav class="nav">
                <a href="#home" class="nav-link active">Home</a>
                <a href="#verify" class="nav-link">Verify ID</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#help" class="nav-link">Help</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Hero Section -->
        <section id="home" class="hero">
            <div class="container">
                <div class="hero-content">
                    <h2>Secure ID Verification for Pasig City</h2>
                    <p>Advanced CNN-based system to detect counterfeit Senior Citizen and PWD identification cards</p>
                    <div class="hero-buttons">
                        <button class="btn btn-primary" onclick="scrollToSection('verify')">
                            <i class="fas fa-camera"></i>
                            Verify ID Now
                        </button>
                        <button class="btn btn-secondary" onclick="scrollToSection('about')">
                            <i class="fas fa-info-circle"></i>
                            Learn More
                        </button>
                    </div>
                </div>
                <div class="hero-image">
                    <div class="id-card-preview">
                        <div class="card-front">
                            <div class="card-header">
                                <h3>Senior Citizen ID</h3>
                                <span class="card-type">PWD</span>
                            </div>
                            <div class="card-content">
                                <div class="photo-placeholder"></div>
                            <div class="card-details">
                                <p><strong>Name:</strong> <span>—</span></p>
                                <p><strong>ID No:</strong> <span>—</span></p>
                                <p><strong>Valid Until:</strong> <span>—</span></p>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Verification Section -->
        <section id="verify" class="verify-section">
            <div class="container">
                <div class="section-header">
                    <h2>ID Verification</h2>
                    <p>Upload your Senior Citizen or PWD ID for verification</p>
                </div>
                
                <div class="verification-container">
                    <div class="input-mode-switch" role="tablist" aria-label="Input method">
                        <button class="mode-tab active" role="tab" aria-selected="true" data-mode="upload">
                            <i class="fas fa-upload"></i> Upload
                        </button>
                        <button class="mode-tab" role="tab" aria-selected="false" data-mode="camera">
                            <i class="fas fa-camera"></i> Camera
                        </button>
                        <button class="mode-tab" role="tab" aria-selected="false" data-mode="scanner">
                            <i class="fas fa-print"></i> Scanner
                        </button>
                    </div>

                    <!-- Upload Panel -->
                    <div class="upload-area panel active" id="uploadArea" role="tabpanel" aria-labelledby="mode-upload">
                        <div class="upload-content">
                            <i class="fas fa-cloud-upload-alt upload-icon"></i>
                            <h3>Upload ID Card</h3>
                            <p>Drag and drop your ID image here or click to browse</p>
                            <p class="upload-hint">Supported formats: JPG, PNG, PDF (Max 10MB)</p>
                            <p class="upload-hint">Accepted IDs: Senior Citizen & PWD ID Cards only</p>
                            <input type="file" id="fileInput" accept="image/*,.pdf" hidden>
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                <i class="fas fa-folder-open"></i>
                                Choose File
                            </button>
                        </div>
                    </div>

                    <!-- Camera Panel -->
                    <div class="camera-area panel" id="cameraArea" role="tabpanel" aria-labelledby="mode-camera" aria-hidden="true">
                        <div class="camera-grid">
                            <div class="camera-preview">
                                <video id="cameraVideo" autoplay playsinline muted></video>
                                <canvas id="cameraCanvas" hidden></canvas>
                            </div>
                            <div class="camera-controls">
                            <div class="tips">
                                <h4>Tips for a clear capture</h4>
                                <ul>
                                    <li>Place ID on a flat, well-lit surface</li>
                                    <li>Fill the frame and avoid glare</li>
                                    <li>Hold steady for 2 seconds</li>
                                    <li>Only Senior Citizen & PWD IDs accepted</li>
                                </ul>
                            </div>
                                <div class="buttons">
                                    <button id="startCameraBtn" class="btn btn-secondary">
                                        <i class="fas fa-video"></i> Start Camera
                                    </button>
                                    <button id="captureBtn" class="btn btn-primary" disabled>
                                        <i class="fas fa-camera"></i> Capture
                                    </button>
                                    <button id="retakeBtn" class="btn" disabled>
                                        <i class="fas fa-undo"></i> Retake
                                    </button>
                                </div>
                                <p class="upload-hint">Your camera feed never leaves your device.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Scanner Panel -->
                    <div class="scanner-area panel" id="scannerArea" role="tabpanel" aria-labelledby="mode-scanner" aria-hidden="true">
                        <div class="upload-content">
                            <i class="fas fa-print upload-icon"></i>
                            <h3>Scan ID via Scanner</h3>
                            <p>Use your scanner app to scan the ID, save as image or PDF, then upload.</p>
                            <p class="upload-hint">Recommended: 300 DPI, color, JPG/PNG or PDF</p>
                            <p class="upload-hint">Accepted IDs: Senior Citizen & PWD ID Cards only</p>
                            <input type="file" id="scannerFileInput" accept="image/*,.pdf" hidden>
                            <div class="scanner-actions">
                                <button class="btn btn-secondary" onclick="window.open('ms-scan:','_self')">
                                    <i class="fas fa-external-link-alt"></i>
                                    Open Windows Scan (if available)
                                </button>
                                <button class="btn btn-primary" onclick="document.getElementById('scannerFileInput').click()">
                                    <i class="fas fa-folder-open"></i>
                                    Upload Scanned File
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="verification-steps">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Upload ID</h4>
                                <p>Take a clear photo or scan your ID</p>
                            </div>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>AI Analysis</h4>
                                <p>Our CNN system analyzes the ID</p>
                            </div>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Results</h4>
                                <p>Get instant verification results</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="results-section" id="resultsSection" style="display: none;">
                    <div class="result-card">
                        <div class="result-header">
                            <h3>Verification Results</h3>
                            <div class="confidence-score" id="confidenceScore">
                                <span class="score-label">Confidence:</span>
                                <span class="score-value" id="scoreValue">--%</span>
                            </div>
                        </div>
                        <div class="result-content">
                            <div class="verification-status" id="verificationStatus">
                                <i class="fas fa-info-circle status-icon"></i>
                                <h4>Awaiting Results</h4>
                                <p>Your verification result will appear here</p>
                            </div>
                            <div class="id-details" id="idDetails">
                                <h5>Detected Information:</h5>
                                <ul>
                                    <li><strong>Type:</strong> <span id="idType">—</span></li>
                                    <li><strong>ID Number:</strong> <span id="idNumber">—</span></li>
                                    <li><strong>Name:</strong> <span id="holderName">—</span></li>
                                    <li><strong>Validity:</strong> <span id="validity">—</span></li>
                                </ul>
                            </div>
                            <div class="security-features">
                                <h5>Security Features Detected:</h5>
                                <div class="features-grid"></div>
                            </div>
                        </div>
                        <div class="result-actions">
                            <button class="btn btn-primary" onclick="verifyAnother()">
                                <i class="fas fa-plus"></i>
                                Verify Another ID
                            </button>
                            <button class="btn btn-secondary" onclick="downloadReport()">
                                <i class="fas fa-download"></i>
                                Download Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="about-section">
            <div class="container">
                <div class="section-header">
                    <h2>About PASecure</h2>
                    <p>Advanced technology protecting Pasig City residents</p>
                </div>
                <div class="about-content">
                    <div class="about-text">
                        <h3>CNN-Based ID Verification</h3>
                        <p>PASecure utilizes state-of-the-art Convolutional Neural Networks (CNN) to detect counterfeit Senior Citizen and PWD identification cards. Our system analyzes multiple security features and patterns to ensure the authenticity of government-issued IDs.</p>
                        
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> Real-time ID verification</li>
                            <li><i class="fas fa-check"></i> High accuracy detection (99.2%)</li>
                            <li><i class="fas fa-check"></i> Support for multiple ID types</li>
                            <li><i class="fas fa-check"></i> Accessibility features for PWD users</li>
                            <li><i class="fas fa-check"></i> Secure data processing</li>
                            <li><i class="fas fa-check"></i> Instant results and reporting</li>
                        </ul>
                    </div>
                    <div class="about-stats">
                        <div class="stat-item">
                            <div class="stat-number">--</div>
                            <div class="stat-label">Accuracy Rate</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">--</div>
                            <div class="stat-label">Availability</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">--</div>
                            <div class="stat-label">Avg. Processing</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Help Section -->
        <section id="help" class="help-section">
            <div class="container">
                <div class="section-header">
                    <h2>Help & Support</h2>
                    <p>Get assistance with using PASecure</p>
                </div>
                <div class="help-content">
                    <div class="faq-section">
                        <h3>Frequently Asked Questions</h3>
                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>How do I take a good photo of my ID?</h4>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                <p>Ensure good lighting, place the ID on a flat surface, and make sure all text is clearly visible. Avoid shadows and reflections.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>What file formats are supported?</h4>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                <p>We support JPG, PNG, and PDF formats. Maximum file size is 10MB.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question">
                                <h4>Is my data secure?</h4>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                <p>Yes, all uploaded images are processed securely and automatically deleted after verification. We follow strict data protection protocols.</p>
                            </div>
                        </div>
                    </div>
                    <div class="contact-section">
                        <h3>Contact Support</h3>
                        <div class="contact-info">
                            <div class="contact-item">
                                <i class="fas fa-phone"></i>
                                <div>
                                    <h4>Phone</h4>
                                    <p>(02) 8-643-1111</p>
                                </div>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-envelope"></i>
                                <div>
                                    <h4>Email</h4>
                                    <p>support@pasig.gov.ph</p>
                                </div>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <div>
                                    <h4>Office</h4>
                                    <p>Pasig City Hall, Plaza Rizal, Pasig City</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>PASecure</h4>
                    <p>Advanced ID verification system for Pasig City residents</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#verify">Verify ID</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#help">Help</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p>Pasig City Hall<br>Plaza Rizal, Pasig City</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 City of Pasig. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Accessibility Features -->
    <div class="accessibility-tools">
        <button class="accessibility-btn" id="fontSizeBtn" title="Increase Font Size">
            <i class="fas fa-text-height"></i>
        </button>
        <button class="accessibility-btn" id="contrastBtn" title="High Contrast Mode">
            <i class="fas fa-adjust"></i>
        </button>
        <button class="accessibility-btn" id="voiceBtn" title="Voice Assistant">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>

    <!-- Load configuration and Supabase client first -->
    <script src="config.js"></script>
    <!-- TensorFlow.js for on-device CNN inference -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"
            onload="console.log('TensorFlow.js loaded, version:', window.tf?.version || 'unknown'); window.tfReady = true;"
            onerror="console.warn('TF.js failed to load; AI analysis unavailable')"></script>
    <!-- Resilient loader for Supabase JS SDK (enables realtime when CDN works) -->
    <script>
    (function tryLoad(i){
        var cdns = [
            'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.js',
            'https://unpkg.com/@supabase/supabase-js@2.38.4/dist/umd/supabase.js',
            'https://cdn.skypack.dev/@supabase/supabase-js@2.38.4'
        ];
        if (i >= cdns.length) { console.warn('Supabase SDK failed to load from all CDNs'); return; }
        var s = document.createElement('script');
        s.src = cdns[i];
        s.onload = function(){ console.log('Supabase SDK loaded:', cdns[i]); };
        s.onerror = function(){ console.warn('Failed:', cdns[i]); tryLoad(i+1); };
        document.head.appendChild(s);
    })(0);
    </script>
    <script src="supabase-client.js"></script>
    <script src="script.js"></script>
</body>
</html>
